
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Tron Blog!">
    <title>标签: FetchAPI - Tron Blog!</title>
    <meta name="author" content="Archie Shi">
    
    
    
    <meta name="description" content="Archie&apos;s Blog">
<meta property="og:type" content="blog">
<meta property="og:title" content="Tron Blog!">
<meta property="og:url" content="https://shianqi.github.io/tags/FetchAPI/index.html">
<meta property="og:site_name" content="Tron Blog!">
<meta property="og:description" content="Archie&apos;s Blog">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tron Blog!">
<meta name="twitter:description" content="Archie&apos;s Blog">
    
    
        
    
    
        <meta property="og:image" content="http://cdn.shianqi.com/20171110003439_iub77X_cat_sm.png"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ywijujnc71acsrrxuejmomiuckrww8ghivq5n28telwc6cwsucrwjgq26ffz.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Tron Blog!</a>
    </div>
    
        
            <a  class="header-right-icon open-algolia-search"
                href="#about">
        
        
            <i class="fa fa-lg fa-search"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="http://cdn.shianqi.com/20171110003439_iub77X_cat_sm.png" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">Archie Shi</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Nothing to say</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/shianqi" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="tencent://message/?uin=1210219084&Site=有事Q我&Menu=yes" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-qq"></i>
                        <span class="sidebar-button-desc">QQ</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:shianqi@imudges.com" target="_blank" rel="noopener">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/06/20/FetchAPI/FetchAPI多个跨域/">
                            Fetch API 多个跨域
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-06-20T18:36:13+08:00">
	
		    6月 20, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>这种写法并不能解决问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: https://www.google.com,https://www.baidu.com</span><br></pre></td></tr></table></figure></p>
<p>应该写成下面这种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.all(&apos;*&apos;, function(req, res, next) &#123;</span><br><span class="line">    if( req.headers.origin == &apos;https://www.google.com&apos; || req.headers.origin == &apos;https://www.baidu.com&apos; )&#123;</span><br><span class="line">        res.header(&quot;Access-Control-Allow-Origin&quot;, req.headers.origin);</span><br><span class="line">        res.header(&apos;Access-Control-Allow-Methods&apos;, &apos;POST, GET&apos;);</span><br><span class="line">        res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;X-Requested-With&apos;);</span><br><span class="line">        res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;Content-Type&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果想不限制域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app.all(&apos;*&apos;, function(req, res, next) &#123;</span><br><span class="line">    res.header(&quot;Access-Control-Allow-Origin&quot;, req.headers.origin);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Methods&apos;, &apos;POST, GET&apos;);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;X-Requested-With&apos;);</span><br><span class="line">    res.header(&apos;Access-Control-Allow-Headers&apos;, &apos;Content-Type&apos;);</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/06/20/FetchAPI/FetchAPI多个跨域/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/06/18/FetchAPI/FetchAPI/">
                            Fetch API
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-06-18T19:44:03+08:00">
	
		    6月 18, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <h2 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h2><p><code>JavaScript</code> 通过 <code>XMLHttpRequest(XHR)</code> 来执行异步请求，这个方式已经存在了很长一段时间。但它不是最佳API。它在设计上不符合职责分离原则，将输入、输出和用事件来跟踪的状态混杂在一个对象里。而且，基于事件的模型与最近 <code>JavaScript</code> 流行的 <code>Promise</code> 以及基于生成器的异步编程模型不太搭。新的 <code>Fetch API</code> 打算修正上面提到的那些缺陷。</p>
<p>而与jQuery相比， fetch 方法与 jQuery.ajax() 的主要区别在于：</p>
<ul>
<li><code>fetch()</code> 方法返回的 <code>Promise</code> 对象并不会在HTTP状态码为404或者500的时候自动抛出异常，而需要用户进行手动处理</li>
<li>默认情况下，<code>fetch</code> 并不会发送任何的本地的 <code>cookie</code> 到服务端，注意，如果服务端依靠 <code>Session</code> 进行用户控制的话要默认开启 <code>Cookie</code></li>
</ul>
<h2 id="Installation-amp-Polyfill"><a href="#Installation-amp-Polyfill" class="headerlink" title="Installation &amp; Polyfill"></a>Installation &amp; Polyfill</h2><p><code>window.fetch</code> 是基于 <code>XMLHttpRequest</code> 的浏览器的统一的封装，针对老的浏览器可以使用 <code>Github</code> 的这个<a href="https://github.com/github/fetch" target="_blank" rel="external">polypill</a>。 <code>fetch</code> 基于 <code>ES6</code> 的 <code>Promise</code> ，在旧的浏览器中首先需要引入 <code>Promise</code>的 <code>polypill</code> ，可以用 <a href="https://github.com/stefanpenner/es6-promise" target="_blank" rel="external">es6-promise</a>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install es6-promise</span><br></pre></td></tr></table></figure></p>
<p>使用 <a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch</a>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save isomorphic-fetch es6-promise</span><br></pre></td></tr></table></figure></p>
<p>使用的时候也非常方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">require(&apos;es6-promise&apos;).polyfill();</span><br><span class="line">require(&apos;isomorphic-fetch&apos;);</span><br><span class="line">fetch(&apos;//offline-news-api.herokuapp.com/stories&apos;)</span><br><span class="line">    .then(function(response) &#123;</span><br><span class="line">        if (response.status &gt;= 400) &#123;</span><br><span class="line">            throw new Error(&quot;Bad response from server&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return response.json();</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(function(stories) &#123;</span><br><span class="line">        console.log(stories);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users.html&apos;)</span><br><span class="line">  .then(function(response) &#123;</span><br><span class="line">    return response.text()</span><br><span class="line">  &#125;).then(function(body) &#123;</span><br><span class="line">    document.body.innerHTML = body</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users.json&apos;)</span><br><span class="line">  .then(function(response) &#123;</span><br><span class="line">    return response.json()</span><br><span class="line">  &#125;).then(function(json) &#123;</span><br><span class="line">    console.log(&apos;parsed json&apos;, json)</span><br><span class="line">  &#125;).catch(function(ex) &#123;</span><br><span class="line">    console.log(&apos;parsing failed&apos;, ex)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Response-metadata"><a href="#Response-metadata" class="headerlink" title="Response metadata"></a>Response metadata</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users.json&apos;).then(function(response) &#123;</span><br><span class="line">  console.log(response.headers.get(&apos;Content-Type&apos;))</span><br><span class="line">  console.log(response.headers.get(&apos;Date&apos;))</span><br><span class="line">  console.log(response.status)</span><br><span class="line">  console.log(response.statusText)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Post-form"><a href="#Post-form" class="headerlink" title="Post form"></a>Post form</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var form = document.querySelector(&apos;form&apos;)</span><br><span class="line"></span><br><span class="line">fetch(&apos;/users&apos;, &#123;</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  body: new FormData(form)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Post-JSON"><a href="#Post-JSON" class="headerlink" title="Post JSON"></a>Post JSON</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users&apos;, &#123;</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/json&apos;</span><br><span class="line">  &#125;,</span><br><span class="line">  body: JSON.stringify(&#123;</span><br><span class="line">    name: &apos;Hubot&apos;,</span><br><span class="line">    login: &apos;hubot&apos;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="File-upload"><a href="#File-upload" class="headerlink" title="File upload"></a>File upload</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var input = document.querySelector(&apos;input[type=&quot;file&quot;]&apos;)</span><br><span class="line"></span><br><span class="line">var data = new FormData()</span><br><span class="line">data.append(&apos;file&apos;, input.files[0])</span><br><span class="line">data.append(&apos;user&apos;, &apos;hubot&apos;)</span><br><span class="line"></span><br><span class="line">fetch(&apos;/avatars&apos;, &#123;</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  body: data</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Request-请求构造"><a href="#Request-请求构造" class="headerlink" title="Request:请求构造"></a>Request:请求构造</h2><p>Request对象代表了一次fetch请求中的请求体部分，你可以自定义Request对象:</p>
<ul>
<li><code>method</code> - 使用的HTTP动词，<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>HEAD</code></li>
<li><code>url</code> - 请求地址，<code>URL of the request</code></li>
<li><code>headers</code> - 关联的Header对象</li>
<li><code>referrer</code> - <code>referrer</code></li>
<li><code>mode</code> - 请求的模式，主要用于跨域设置，<code>cors</code>, <code>no-cors</code>, <code>same-origin</code></li>
<li><code>credentials</code> - 是否发送Cookie <code>omit</code>, <code>same-origin</code></li>
<li><code>redirect</code> - 收到重定向请求之后的操作，<code>follow</code>, <code>error</code>, <code>manual</code></li>
<li><code>integrity</code> - 完整性校验</li>
<li><code>cache</code> - 缓存模式(<code>default</code>, <code>reload</code>, <code>no-cache</code>)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var request = new Request(&apos;/users.json&apos;, &#123;</span><br><span class="line">    method: &apos;POST&apos;,</span><br><span class="line">    mode: &apos;cors&apos;,</span><br><span class="line">    redirect: &apos;follow&apos;,</span><br><span class="line">    headers: new Headers(&#123;</span><br><span class="line">        &apos;Content-Type&apos;: &apos;text/plain&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//use it</span><br><span class="line">fetch(request).then(function() &#123; /* handle response */ &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users.json&apos;, &#123;</span><br><span class="line">    method: &apos;POST&apos;,</span><br><span class="line">    mode: &apos;cors&apos;,</span><br><span class="line">    redirect: &apos;follow&apos;,</span><br><span class="line">    headers: new Headers(&#123;</span><br><span class="line">        &apos;Content-Type&apos;: &apos;text/plain&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(function() &#123; /* handle response */ &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>如果需要设置fetch自动地发送本地的Cookie，需要将credentials设置为same-origin:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/users&apos;, &#123;</span><br><span class="line">  credentials: &apos;same-origin&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>该选项会以类似于XMLHttpRequest的方式来处理Cookie，否则，可能因为没有发送Cookie而导致基于Session的认证出错。可以将credentials的值设置为include来在CORS情况下发送请求。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;https://example.com:1234/users&apos;, &#123;</span><br><span class="line">  credentials: &apos;include&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="Headers-自定义请求头"><a href="#Headers-自定义请求头" class="headerlink" title="Headers:自定义请求头"></a>Headers:自定义请求头</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// Create an empty Headers instance</span><br><span class="line">var headers = new Headers();</span><br><span class="line"></span><br><span class="line">// Add a few headers</span><br><span class="line">headers.append(&apos;Content-Type&apos;, &apos;text/plain&apos;);</span><br><span class="line">headers.append(&apos;X-My-Custom-Header&apos;, &apos;CustomValue&apos;);</span><br><span class="line"></span><br><span class="line">// Check, get, and set header values</span><br><span class="line">headers.has(&apos;Content-Type&apos;); // true</span><br><span class="line">headers.get(&apos;Content-Type&apos;); // &quot;text/plain&quot;</span><br><span class="line">headers.set(&apos;Content-Type&apos;, &apos;application/json&apos;);</span><br><span class="line"></span><br><span class="line">// Delete a header</span><br><span class="line">headers.delete(&apos;X-My-Custom-Header&apos;);</span><br><span class="line"></span><br><span class="line">// Add initial values</span><br><span class="line">var headers = new Headers(&#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;text/plain&apos;,</span><br><span class="line">    &apos;X-My-Custom-Header&apos;: &apos;CustomValue&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用webpack前后端跨域发送cookie的问题"><a href="#使用webpack前后端跨域发送cookie的问题" class="headerlink" title="使用webpack前后端跨域发送cookie的问题"></a>使用webpack前后端跨域发送cookie的问题</h3><p>最简单的方法是服务端将响就头设置成 <code>Access-Control-Allow-Origin：域名</code>，如果客户端发送请求时，不需要携带 <code>cookie</code> 等信息，可以设置成 <code>Access-Control-Allow-Origin：*</code> ，表示任何域都可以向服务端发送请求，客户端不需要任何配置，就可以进行跨域调试了。</p>
<p>但一般网站，都需要向后端发送 <code>cookie</code>来进行身份验证，此时，服务器还需向响应头设置 <code>Access-Control-Allow-Credentials:true</code>，表示跨域时，允许cookie添加到请求中。设置 <code>Access-Control-Allow-Credentials:true</code> 后，要将 <code>Access-Control-Allow-Origin</code> 指定到具体的域，否则cookie不会带到客户端，例如设置成<code>Access-Control-Allow-Origin：http://192.168.0.1:8088</code>,<a href="http://192.168.0.1:8088" target="_blank" rel="external">http://192.168.0.1:8088</a> 是前端服务器的域名，这就要求用webpack的时候，要指定具体的域来启动，不要直接用localhost。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">devServer: &#123;</span><br><span class="line">    host: &apos;192.168.0.1:8088&apos;,</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>要向后端发送cookie，前端也需要有相应的配置。需要将<code>credentials</code>设置成<code>include</code>，表示允许跨越传递<code>cookie</code>，不要将<code>credentials</code>设置成<code>same-origin</code>,如果设置成<code>same-origin</code>，只会在同源的时候发送cookie。另外还要将 <code>withCredentials</code> 设为<code>true</code>。</p>
<h2 id="Response-响应处理"><a href="#Response-响应处理" class="headerlink" title="Response:响应处理"></a>Response:响应处理</h2><p>在fetch的then函数中提供了一个Response对象，即代表着对于服务端返回值的封装，你也可以在Mock的时候自定义Response对象，譬如在你需要使用Service Workers的情况下，在Response中，你可以作如下配置:</p>
<ul>
<li><code>type</code> - basic, cors</li>
<li><code>url</code></li>
<li><code>useFinalURL</code> - 是否为最终地址</li>
<li><code>status</code> - 状态码 (ex: 200, 404, etc.)</li>
<li><code>ok</code> - 是否成功响应 (status in the range 200-299)</li>
<li><code>statusText</code> - status code (ex: OK)</li>
<li><code>headers</code> - 响应头</li>
</ul>
<p>The <code>Response</code> also provides the following methods:</p>
<ul>
<li><code>clone()</code>- Creates a clone of a Response object.</li>
<li><code>error()</code> - Returns a new Response object associated with a network error.</li>
<li><code>redirect()</code> - Creates a new response with a different URL.</li>
<li><code>arrayBuffer()</code> - Returns a promise that resolves with an ArrayBuffer.</li>
<li><code>blob()</code> - Returns a promise that resolves with a Blob.</li>
<li><code>formData()</code> - Returns a promise that resolves with a FormData object.</li>
<li><code>json()</code> - Returns a promise that resolves with a JSON object.</li>
<li><code>text()</code> - Returns a promise that resolves with a USVString (text).</li>
</ul>
<h3 id="处理HTTP错误状态"><a href="#处理HTTP错误状态" class="headerlink" title="处理HTTP错误状态"></a>处理HTTP错误状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function checkStatus(response) &#123;</span><br><span class="line">  if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) &#123;</span><br><span class="line">    return response</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    var error = new Error(response.statusText)</span><br><span class="line">    error.response = response</span><br><span class="line">    throw error</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function parseJSON(response) &#123;</span><br><span class="line">  return response.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch(&apos;/users&apos;)</span><br><span class="line">  .then(checkStatus)</span><br><span class="line">  .then(parseJSON)</span><br><span class="line">  .then(function(data) &#123;</span><br><span class="line">    console.log(&apos;request succeeded with JSON response&apos;, data)</span><br><span class="line">  &#125;).catch(function(error) &#123;</span><br><span class="line">    console.log(&apos;request failed&apos;, error)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="处理JSON响应"><a href="#处理JSON响应" class="headerlink" title="处理JSON响应"></a>处理JSON响应</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;https://davidwalsh.name/demo/arsenal.json&apos;).then(function(response) &#123;</span><br><span class="line"></span><br><span class="line">// Convert to JSON</span><br><span class="line"></span><br><span class="line">return response.json();</span><br><span class="line"></span><br><span class="line">&#125;).then(function(j) &#123;</span><br><span class="line"></span><br><span class="line">// Yay, `j` is a JavaScript object</span><br><span class="line"></span><br><span class="line">console.log(j);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="处理文本响应"><a href="#处理文本响应" class="headerlink" title="处理文本响应"></a>处理文本响应</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;/next/page&apos;)</span><br><span class="line"></span><br><span class="line">  .then(function(response) &#123;</span><br><span class="line"></span><br><span class="line">    return response.text();</span><br><span class="line"></span><br><span class="line">  &#125;).then(function(text) &#123;</span><br><span class="line"></span><br><span class="line">  // &lt;!DOCTYPE ....</span><br><span class="line"></span><br><span class="line">  console.log(text);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Blob-Responses"><a href="#Blob-Responses" class="headerlink" title="Blob Responses"></a>Blob Responses</h3><p>如果你希望通过fetch方法来载入一些类似于图片等资源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fetch(&apos;flowers.jpg&apos;)</span><br><span class="line"></span><br><span class="line">    .then(function(response) &#123;</span><br><span class="line"></span><br><span class="line">       return response.blob();</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    .then(function(imageBlob) &#123;</span><br><span class="line"></span><br><span class="line">       document.querySelector(&apos;img&apos;).src = URL.createObjectURL(imageBlob);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">blob()方法会接入一个响应流并且一直读入到结束。</span><br></pre></td></tr></table></figure>

                    
                        
                    
                    
                        <p>
                            <a href="/2017/06/18/FetchAPI/FetchAPI/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 Archie Shi. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://cdn.shianqi.com/20171110003439_iub77X_cat_sm.png" alt="作者的图片"/>
        
            <h4 id="about-card-name">Archie Shi</h4>
        
            <div id="about-card-bio"><p>Nothing to say</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Front-End Development Engineer</p>

            </div>
        
        
    </div>
</div>

        <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">没有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/WebSocket/SocketIo/">
                            <h3 class="media-heading">用 Express,Socket.io 搭建 WebSocket 服务器</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/Windows/CMD快速配置IP/">
                            <h3 class="media-heading">CMD快速配置IP地址和DNS</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/BrowserSync/BrowserSync/">
                            <h3 class="media-heading">BrowserSync 使用手册</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/MongoDB/基本语法/">
                            <h3 class="media-heading">MongoDB 基本语法</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/JavaScript/Javascript/">
                            <h3 class="media-heading">JavaScript 简介</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/09/04/JavaScript/Event/">
                            <h3 class="media-heading">JavaScript 事件捕获和冒泡</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年9月4日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/11/14/Webpack/Webpack基础/">
                            <h3 class="media-heading">Webpack 学习笔记</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年11月14日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/12/10/PenetrationTest/ARP/ARP/">
                            <h3 class="media-heading">嗅探，arp欺骗，会话劫持</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年12月10日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/12/20/PenetrationTest/WiFiCrack/WiFiCrack/">
                            <h3 class="media-heading">用 Kali-Linux 进行 Wifi 破解</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年12月20日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="https://shianqi.github.io/2016/12/22/PenetrationTest/KaliUpdata/">
                            <h3 class="media-heading">Kali-Linux 更新、环境配置</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年12月22日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="没有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 103 篇文章
            </p>
        </div>
    </div>
</div>

        
<div id="cover" style="background-image:url('http://cdn.shianqi.com/20171111132834_TkfCwb_dr.jpeg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-lh5udltchpsfcjgzpmme11bbmvj4k4srd99grgzo0845ualxoy17enpqvhko.min.js"></script>
<!--SCRIPTS END-->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script>
    <script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script>
        var algoliaClient = algoliasearch('DIJHXM8BEG', '65699e0c957896b498d3cf67daac9c0f');
        var algoliaIndex = algoliaClient.initIndex('blog');
    </script>

    </body>
</html>
