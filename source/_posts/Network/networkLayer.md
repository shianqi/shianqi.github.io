---
title: 计算机网络——网络层基本概念
date: 2017-1-7 12:36:41
tags: 
    - 计算机网络
---

# 网络层 #
## 网络层提供的两种服务 ##
__网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。__网络在发送分组时不需要先建立连接。每一个分组（也就是IP数据报）独立发送，与其后面的分组无关（不进行编号）。__网络层不提供服务质量的承诺__。

|对比的方面 | 虚电路服务 | 数据服务 |
|--------- | ---- | ---- |
|思路 | 可靠通信应当由网络来保证 | 可靠通信应当由用户主机来保证 |
|链接的建立|必须有|不需要
|终点地址|仅在链接建立阶段使用，每个分组使用短的虚电路号|每个分组都有终点的完整地址|
|分组的转发|属于同一条虚电路的分组均按照同一路由进行转发|每个分组独立选择路由进行转发|
|当结点出故障时|所有通过故障的虚电路均不能工作|出故障的节点可能会丢失分组，一些路由可能发生变化|
|分组的顺序|总是按发送顺序到达终点|到达时间不一定按照发送顺序|
|端到端差错处理和流量控制|可以由网络负责，也可以由用户主机负责|由用户主机负责|

## 网际协议IP ##
网际协议IP是TCP/IP体系中两个最主要的协议之一，与之配套使用的还有三个协议：
* 地址解析协议 ARP（Address Resolution Protocol）
* 网际控制报文协议 ICMP （Internet Control Message Protocol）
* 网络组管理协议 IGMP（Internet Group Management Protocol）

### 虚拟互联网络 ###
将网络互相链接起来要使用一些中间设备。根据中间设备所在的层次，可以有以下四种不同的中间设备。
* 物理层：__转发器__
* 数据链路层：__网桥__或__桥接器__
* 网络层：__路由器__
* 网络层以上：__网关__，用网关链接连个不兼容的系统需要在高层进行协议转换。

### 分类的IP地址 ###
IP地址：给因特网上的每一个主机（或路由器）的每一个接口分配一个在全世界范围是唯一的32位的标识符。
IP地址的编址方法：
1. 分类的IP地址
2. 子网的划分
3. 构成超网

分类IP地址：每一类地址都是由两个固定长度的字段组成，其中一个字段是__网络号__，它标志主机（或路由器）所链接到的网络。第二个字段是__主机号__，它标志该主机（或路由器）。主机号在前面网络号所指明的范围是唯一的。

|地址类别|地址前缀|网络号长度|可指派网络号|每个网路号可指派的地址|
|---|---|---|---|---|
|A类地址|0|8|126 (2<sup>7</sup>-2)包括全0和127(环回地址)|16777214 (2<sup>14</sup>-1)|
|B类地址|10|16|16383 (2<sup>14</sup>-1)|65534 (2<sup>16</sup>-2)|
|C类地址|110|24| 2097151 (2<sup>21</sup>-1) | 254 (2<sup>8</sup>-1) |
|D类地址|1110|多播地址| - | - |
|E类地址|1111|保留为今后使用| - | - |

__IP地址放在IP数据的首部，而硬件地址则放在MAC帧的首部。在网络层和网络层以上使用的是IP地址，而数据链路层及以上使用的是硬件地址。__

### 地址解析协议ARP ###
为了解决：已经知道一个机器（主机或路由器）的IP地址，需要找出其相应的硬件地址。

解决方法：在主机ARP高速缓存中存放一个从IP地址到硬件地址的映射表，并且这个映射表还经常动态更新（新增或动态删除）。

过程：
1. 广播发送ARP请求分组
2. 在本局域网上的所有主机上运行的ARP进程都收到此ARP请求分组
3. 如果有一个主机的IP与查询IP一致，则就收下这个ARP请求，并发送ARP响应分组。不一致则不理睬，所以ARP响应是单播。
4. 源主机收到ARP响应分组后，在ARP高速缓存中写下主机B的IP地址到硬件地址的映射。

### IP数据报的格式 ###
一个IP数据报由首部和数据两部分组成。首部前一部分是__固定长度__，共20字节，是所有IP数据报必须具有的。首部的后面一部分是可选字段，长度可变。
